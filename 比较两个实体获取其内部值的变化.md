# 比较两个实体获取其内部值的变化

```java
import com.alibaba.fastjson.JSONObject;
import org.springframework.util.Assert;

import java.io.*;
import java.lang.reflect.Field;
import java.util.Arrays;
import java.util.List;
import java.util.Objects;

/**
     *
     * @param before 前一个对象
     * @param after 后一个对象
     * @param editable 对象类型
     * @param ignoreProperties 忽略的属性
     * @return 两个对象的相同参数的不同值
     */
    public static JSONObject findDifferent(Object before, Object after, Class<?> editable, String... ignoreProperties) {
        Assert.notNull(before, "Before must not be null");
        Assert.notNull(after, "After must not be null");
        
        Class<?> afterClass = after.getClass();
        Class<?> beforeClass = before.getClass();
        if (editable != null) {
            if (!editable.isInstance(after)&&!editable.isInstance(before)) {
                throw new IllegalArgumentException("After and Before class [" + afterClass.getName() +
                        "] not assignable to Editable class [" + editable.getName() + "]");
            }
        }else {
            if (!(afterClass == beforeClass)) {
                throw new IllegalArgumentException("After Class [" + afterClass.getName() +
                        "] not assignable to Before class [" + beforeClass.getName() + "]");
            }
        }
        List<String> ignoreList = (ignoreProperties != null ? Arrays.asList(ignoreProperties) : null);
        boolean isIgnore = ignoreList!=null;
        Field[] afterFields = afterClass.getDeclaredFields();
        Field[] beforeFields = beforeClass.getDeclaredFields();
        JSONObject jsonObject = new JSONObject();
        try {
        for (Field afterField : afterFields) {
            afterField.setAccessible(true);
            String afterFieldName = afterField.getName();
            if(isIgnore&&ignoreList.contains(afterFieldName)){
                continue;
            }
            for (Field beforeField : beforeFields) {
                beforeField.setAccessible(true);
                String beforeFieldName = beforeField.getName();
                if (afterFieldName.equals(beforeFieldName)) {
                    Object beforeObject = beforeField.get(before);
                    Object afterObject = afterField.get(after);
                    if (Objects.equals(afterObject, beforeObject)) {
                        break;
                    }
                    if (afterObject != null) {
                        jsonObject.put(afterFieldName + "After", afterObject);
                    } else {
                        jsonObject.put(afterFieldName + "After", "delete");
                    }

                    if (beforeObject != null) {
                        jsonObject.put(beforeFieldName + "Before", beforeObject);
                    }else {
                        jsonObject.put(beforeFieldName + "Before", "add");
                    }
                    break;
                }
            }
        }
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        }
        return jsonObject;
    }
```

测试

```java
@Test
	public void c(){
		UserDO userDO = new UserDO();
		userDO.setUserId(110L);
		userDO.setPassword("123");
		UserDO userDO1 = new UserDO();
		userDO1.setUserId(120L);
		userDO1.setPassword("456");
		UserAssocDO userAssocDO = new UserAssocDO();
		userAssocDO.setId(120L);
		userAssocDO.setAssocType("456");
		JSONObject different = com.ev.framework.utils.BeanUtils.findDifferent(userDO, userDO1);
		System.err.println(different);
	}

打印结果
    {"userIdBefore":110,"passwordBefore":"123","passwordAfter":"456","userIdAfter":120}
```

